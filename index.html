<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zebrafish Complement Dashboard</title>
    
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background-color: #004d40; /* Dark teal */
            color: #ffffff;
            padding: 1rem 0;
            text-align: center;
            border-bottom: 5px solid #00796b; /* Lighter teal */
        }
        header h1 {
            margin: 0;
            font-size: 2.5rem;
        }
        section {
            background: #ffffff;
            margin: 20px 0;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        h2 {
            color: #004d40;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            font-size: 0.9em;
            color: #777;
        }
        .plot-container {
            width: 100%;
            height: 600px;
        }
        .loader {
            border: 8px solid #f3f3f3;
            border-radius: 50%;
            border-top: 8px solid #004d40;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
            margin: 50px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <header>
        <h1>Zebrafish Complement System Dashboard</h1>
    </header>

    <div class="container">
        <section id="introduction">
            <h2>🚀 Project Overview</h2>
            <p>
                This project performs a comprehensive analysis of the Zebrafish complement system using transcriptomics data. The goal is to identify differentially expressed genes (DEGs) and understand their roles in biological pathways. The primary visualization used here is a volcano plot, which helps in identifying genes that are both statistically significant and show a substantial magnitude of change.
            </p>
        </section>

        <section id="visualization">
            <h2>📊 Interactive Volcano Plot</h2>
            <p>
                This plot displays statistical significance (p-value) versus magnitude of change (fold change). Hover over any point to see details for that specific gene. You can also zoom and pan to explore dense areas of the plot.
            </p>
            <div id="volcanoPlot" class="plot-container">
                <div class="loader"></div> </div>
        </section>
        
        <section id="findings">
            <h2>💡 Key Findings</h2>
            <p>
                This section will be updated with a summary of the key findings from the analysis once all plots are integrated and reviewed.
            </p>
        </section>
    </div>

    <footer>
        <p>Developed for project presentation. For full code and data, visit the <a href="https://github.com/tshrayansh/Zebrafish-complement-dashboard" target="_blank">GitHub Repository</a>.</p>
    </footer>

    <script>
        // URL to your raw CSV file on GitHub
        const dataUrl = 'https://raw.githubusercontent.com/tshrayansh/Zebrafish-complement-dashboard/main/data/final_df.csv';

        // Function to create the Volcano Plot
        function createVolcanoPlot(data) {
            let upRegulated = { x: [], y: [], text: [], mode: 'markers', name: 'Up-regulated', marker: { color: 'red', size: 8, opacity: 0.7 } };
            let downRegulated = { x: [], y: [], text: [], mode: 'markers', name: 'Down-regulated', marker: { color: 'blue', size: 8, opacity: 0.7 } };
            let nonSignificant = { x: [], y: [], text: [], mode: 'markers', name: 'Not Significant', marker: { color: 'grey', size: 6, opacity: 0.5 } };
            
            // Significance thresholds
            const pValueThreshold = 0.05;
            const log2FcThreshold = 1.0;

            data.forEach(row => {
                const logPValue = -Math.log10(row.pvalue);
                const target = { x: row.log2FoldChange, y: logPValue, text: `Gene: ${row.gene_name}<br>log2FC: ${row.log2FoldChange.toFixed(2)}<br>p-value: ${row.pvalue.toExponential(2)}` };
                
                if (row.pvalue < pValueThreshold && row.log2FoldChange > log2FcThreshold) {
                    upRegulated.x.push(target.x);
                    upRegulated.y.push(target.y);
                    upRegulated.text.push(target.text);
                } else if (row.pvalue < pValueThreshold && row.log2FoldChange < -log2FcThreshold) {
                    downRegulated.x.push(target.x);
                    downRegulated.y.push(target.y);
                    downRegulated.text.push(target.text);
                } else {
                    nonSignificant.x.push(target.x);
                    nonSignificant.y.push(target.y);
                    nonSignificant.text.push(target.text);
                }
            });

            const layout = {
                title: '<b>Volcano Plot of Differentially Expressed Genes</b>',
                xaxis: { title: 'log₂ Fold Change' },
                yaxis: { title: '-log₁₀ p-value' },
                hovermode: 'closest',
                showlegend: true,
                legend: { x: 1, xanchor: 'right', y: 1 }
            };

            Plotly.newPlot('volcanoPlot', [nonSignificant, downRegulated, upRegulated], layout);
        }

        // Fetch and parse the CSV data
        Plotly.d3.csv(dataUrl, (error, data) => {
            if (error) {
                console.error('Error loading or parsing data:', error);
                document.getElementById('volcanoPlot').innerHTML = '<p style="color:red; text-align:center;">Failed to load data. Please check the console for details.</p>';
                return;
            }
            
            // Convert numerical strings to numbers
            data.forEach(d => {
                d.log2FoldChange = +d.log2FoldChange;
                d.pvalue = +d.pvalue;
            });

            createVolcanoPlot(data);
        });
    </script>

</body>
</html>
